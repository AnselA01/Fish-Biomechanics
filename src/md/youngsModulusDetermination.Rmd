---
output: html_document
editor_options: 
  chunk_output_type: console
---


```{r}
library(tidyverse)
source("./src/script/youngsModulusDetermination.R")
source("./src/script/youngsModulus.R")
source("./src/script/data.R")
source("./src/script/helpers/general.R")
source("./src/script/plot.R")
source("./src/script/image.R")
```

```{r}
pf02ut3 <- data.fetch(subject = "pf02ut3")
pf16ut1 <- data.fetch(subject = "pf16ut1")
result1 <- ym.calculateAndDetermine(pf02ut3)
result2 <- ym.calculateAndDetermine(pf16ut1)

```


```{r}
bones <- data.generator()
names <- vector(length = 273)
method <- vector(length = 273)
slope <- vector(length = 273)
score <- vector(length = 273)
strain <- vector(length = 273)
rsquared <- vector(length = 273)

```

```{r}
doPlot <- FALSE
doSave <- FALSE

i <- 1
for (bone in bones) {
  ym.result <- ym.calculate(bone)
  if (is.null(ym.result)) next
  choose <- ym.determine(ym.result)
  
  name <- getName(bone)
  names[i] <- name
  method[i] <- choose$method
  slope[i] <- choose$slope
  score[i] <- choose$score
  strain[i] <- choose$strain
  rsquared[i] <- ym.result$r.squared
  i <- i + 1
  
  if (doPlot) {
    plot.subtitle <- paste(
      "<b>Method:</b> ",
      choose$method,
      "<br>",
      "<b>Slope:</b>",
      round(choose$slope, 1),
      "<br>",
      "<b>Score</b>",
      round(choose$score, 3),
      "<br>",
      "<b>R-squared:</b>",
      round(ym.result$r.squared, 1),
      "<br>"
    )
    
    plot <- plot.plot(
      bone,
      layers = list(
        geom_segment(
          x = choose$strain,
          xend = choose$strain,
          y = 0,
          yend = max(bone$Stress),
          color = "red"
        ),
        labs(subtitle = plot.subtitle)
      )
    )
    
    print(plot)
  }
  
  if (doSave) {
    image.save(bone, plot, directory = "ymResults/decisions")
  }
  
}
```

```{r}
results <- data.frame(names, method, slope, score, strain, rsquared)
```


